<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Connor Hill's Blog</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero">
      <nav class="nav">
        <div class="brand">
          <span class="brand-mark">Ô£ø</span>
          <div class="brand-text">
            <p class="brand-title">Connor Hill</p>
            <p class="brand-subtitle">iOS Developer ¬∑ Blog & Portfolio</p>
          </div>
        </div>
        <div class="nav-actions">
          <button class="ghost-button" type="button" onclick="window.location.href='#settings'">Subscribe</button>
          <button class="secondary-button" type="button" id="adminPanelBtn" style="display: none;" onclick="window.location.href='admin.html'">Admin Panel</button>
          <button class="primary-button" type="button" id="loginBtn">Log In</button>
        </div>
      </nav>
      <div class="hero-content">
        <div class="hero-text">
          <p class="eyebrow">Swift ¬∑ UIKit ¬∑ SwiftUI ¬∑ Xcode</p>
          <h1>Sharing my coding journey through polished iOS experiences.</h1>
          <p class="hero-description">
            A modern space to document lessons learned, showcase shipped apps,
            and connect with developers who care about craftsmanship.
          </p>
          <div class="hero-cta">
            <button class="primary-button" type="button" onclick="window.location.href='#settings'">Join the Blog</button>
            <button class="secondary-button" type="button" onclick="window.location.href='#portfolio'">View Portfolio</button>
          </div>
        </div>
        <div class="hero-card">
          <h2>Newsletter Highlights</h2>
          <p>
            New blog posts and project launches are delivered straight to your
            inbox. Confirm your email within 24 hours to activate alerts.
          </p>
          <div class="email-tags">
            <span>New Posts</span>
            <span>Portfolio Drops</span>
            <span>iOS Tips</span>
          </div>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="tabs">
        <button class="tab active" data-tab="blogs">Blogs</button>
        <button class="tab" data-tab="portfolio">Portfolio</button>
        <button class="tab" data-tab="about">About Me</button>
        <button class="tab" data-tab="settings">Settings</button>
      </section>

      <section class="tab-panel active" id="blogs">
        <div class="panel-header">
          <div>
            <h2>All Blog Posts</h2>
            <p class="muted">
              Deep dives, quick tips, and lessons from building iOS products.
            </p>
          </div>
        </div>

        <div id="blogPostsList">
          <!-- Blog posts with comments will be dynamically inserted here -->
        </div>
      </section>

      <section class="tab-panel" id="portfolio">
        <div class="panel-header">
          <div>
            <h2>Portfolio</h2>
            <p class="muted">
              A curated list of iOS apps, experiments, and shipped features.
            </p>
          </div>
          <button class="filter-pill">Featured</button>
        </div>
        <div class="content-grid">
          <article class="card project-card">
            <a href="https://apps.apple.com/us/app/perk-punch/id6746662386" target="_blank" class="project-icon-link">
              <img
                class="project-icon"
                src="https://via.placeholder.com/120/3579ff/ffffff?text=PP"
                alt="Perk Punch app icon"
              />
            </a>
            <h3>
              <a href="https://apps.apple.com/us/app/perk-punch/id6746662386" target="_blank">Perk Punch</a>
            </h3>
            <p>Punch Your Way to Perks.</p>
            <div class="project-tags">
              <span>Loyalty</span>
              <span>Rewards</span>
              <span>iOS</span>
            </div>
          </article>
          <article class="card project-card">
            <a href="https://apps.apple.com/us/app/bookworm/id6738531588" target="_blank" class="project-icon-link">
              <img
                class="project-icon"
                src="https://via.placeholder.com/120/3579ff/ffffff?text=BW"
                alt="BookWorm! app icon"
              />
            </a>
            <h3>
              <a href="https://apps.apple.com/us/app/bookworm/id6738531588" target="_blank">BookWorm!</a>
            </h3>
            <p>Library, organize, search.</p>
            <div class="project-tags">
              <span>Library</span>
              <span>Catalog</span>
              <span>Search</span>
            </div>
          </article>
          <article class="card project-card">
            <a href="https://apps.apple.com/us/app/auto-do-it/id6670796120" target="_blank" class="project-icon-link">
              <img
                class="project-icon"
                src="https://via.placeholder.com/120/3579ff/ffffff?text=ADI"
                alt="Auto Do It app icon"
              />
            </a>
            <h3>
              <a href="https://apps.apple.com/us/app/auto-do-it/id6670796120" target="_blank">Auto Do It</a>
            </h3>
            <p>ToDo List Plan, Organize, AI.</p>
            <div class="project-tags">
              <span>To-Do</span>
              <span>Planning</span>
              <span>AI</span>
            </div>
          </article>
        </div>
      </section>

      <section class="tab-panel" id="about">
        <div class="panel-header">
          <div>
            <h2>About the Author</h2>
            <p class="muted">My journey into iOS development and what drives me.</p>
          </div>
        </div>
        <div class="card about-card">
          <h3 style="margin-bottom: 16px; color: var(--text-primary);">Connor Hill</h3>
          <p>
            I began my iOS development journey 2 years ago, diving deep into Swift, SwiftUI, and the Apple ecosystem. 
            What started as curiosity about building mobile apps quickly evolved into a passion for crafting polished, 
            user focused experiences.
          </p>
          <p>
            Since then, I've successfully launched 3 apps on the App Store, each teaching me valuable lessons about 
            design, performance optimization, and the importance of user feedback. From conceptualization to 
            App Store submission, I've experienced the full development lifecycle and loved every minute of it.
          </p>
          <p>
            Through this blog, I document my learning process, share insights on iOS development best practices, 
            and explore the evolving landscape of Apple platforms. Whether it's deep diving into SwiftUI patterns, 
            profiling app performance, or discussing architecture decisions, I aim to create content that helps myself and
            fellow developers grow.
          </p>
          <p>
            I plan to continue expanding my app portfolio, experimenting with new Apple technologies, and learning 
            as much as I can about building awesome iOS experiences just like that first time I uploaded to the App Store! My goal is to master Apple's 
            APIs and frameworks while sharing what I learn along the way. Enjoy!
          </p>
          <div class="about-stats">
            <div>
              <h4 style="color: var(--accent);">2+</h4>
              <span>Years in iOS</span>
            </div>
            <div>
              <h4 style="color: var(--accent);">3</h4>
              <span>Apps in App Store</span>
            </div>
            <div>
              <h4 style="color: var(--accent);">‚àû</h4>
              <span>Always Learning</span>
            </div>
          </div>
          <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border);">
            <p style="margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
              Let's Connect
            </p>
            <p style="color: var(--text-secondary); margin-bottom: 12px;">
              Have questions, collaboration ideas, or just want to chat about iOS development?
            </p>
            <p>
              <strong>Email:</strong> 
              <a href="mailto:hilljamesconnor@gmail.com" style="color: var(--accent); text-decoration: none;">
                hilljamesconnor@gmail.com
              </a>
            </p>
          </div>
        </div>
      </section>

      <section class="tab-panel" id="settings">
        <!-- Not Logged In View -->
        <div id="settingsNotLoggedIn">
          <div class="panel-header">
            <div>
              <h2>Newsletter</h2>
              <p class="muted">
                Subscribe to get notified when I publish new posts or launch new projects.
              </p>
            </div>
          </div>
          <div class="settings-grid">
            <form class="card join-card" id="joinForm">
              <h3>Subscribe</h3>
              <p>
                Create an account to follow along with new iOS tutorials and app releases.
              </p>
              <div id="signupStep">
                <input type="text" name="fullName" id="joinFullName" placeholder="Full name" required />
                <input type="email" name="email" id="joinEmail" placeholder="Email address" required />
                <input type="password" name="password" id="joinPassword" placeholder="Create password (min 6 characters)" required minlength="6" />
                <button class="primary-button" type="submit">Create Account</button>
              </div>
              <div id="verificationStep" style="display: none;">
                <h4>Check Your Email</h4>
                <p style="color: var(--text-secondary); font-size: 14px;">
                  We sent a 6-digit verification code to <strong id="verifyEmail"></strong>
                </p>
                <input type="text" id="verificationCode" placeholder="Enter 6-digit code" maxlength="6" pattern="[0-9]{6}" required style="text-align: center; font-size: 24px; font-weight: 600; letter-spacing: 8px;" />
                <button class="primary-button" type="button" id="verifyCodeBtn">Verify & Complete</button>
                <div style="display: flex; gap: 8px;">
                  <button class="secondary-button" type="button" id="resendCodeBtn" style="flex: 1;">Resend Code</button>
                  <button class="ghost-button" type="button" id="cancelVerificationBtn" style="flex: 1;">Cancel</button>
                </div>
              </div>
              <div class="form-message" id="joinMessage" role="status"></div>
              <p class="form-note">
                <small>No spam. Unsubscribe anytime.</small>
              </p>
            </form>

            <div class="card preferences-card">
              <h3>What to Expect</h3>
              <div class="benefits-list">
                <div class="benefit-item">
                  <div>
                    <h4>New Post Notifications</h4>
                    <p class="muted">Get an email when I publish a new tutorial or article.</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <div>
                    <h4>Project Updates</h4>
                    <p class="muted">Updates when I launch new apps or add to my portfolio.</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <div>
                    <h4>Comment Notifications</h4>
                    <p class="muted">Optional replies to your comments on posts.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Logged In View -->
        <div id="settingsLoggedIn" style="display: none;">
          <div class="panel-header">
            <div>
              <h2>Account Settings</h2>
              <p class="muted">
                Manage your preferences, password, and account.
              </p>
            </div>
          </div>
          
          <div class="settings-grid-full">
            <!-- Email Preferences -->
            <div class="card settings-section">
              <h3>Email Preferences</h3>
              <p class="muted" style="margin-bottom: 20px;">Choose what you want to be notified about via email.</p>
              <div class="preferences-list">
                <label class="preference-item">
                  <input type="checkbox" id="prefNewPosts" checked />
                  <div>
                    <h4>New Blog Posts</h4>
                    <p class="muted">Get notified when I publish a new article or tutorial.</p>
                  </div>
                </label>
                <label class="preference-item">
                  <input type="checkbox" id="prefProjects" checked />
                  <div>
                    <h4>Project Updates</h4>
                    <p class="muted">Updates when I launch new apps or portfolio additions.</p>
                  </div>
                </label>
                <label class="preference-item">
                  <input type="checkbox" id="prefCommentReplies" checked />
                  <div>
                    <h4>Comment Replies</h4>
                    <p class="muted">Get notified when someone replies to your comments.</p>
                  </div>
                </label>
                <label class="preference-item">
                  <input type="checkbox" id="prefWeeklyDigest" />
                  <div>
                    <h4>Weekly Digest</h4>
                    <p class="muted">A weekly summary of posts and updates you might have missed.</p>
                  </div>
                </label>
              </div>
              <button class="primary-button" id="savePreferencesBtn" style="margin-top: 20px;">Save Preferences</button>
              <div class="form-message" id="preferencesMessage" role="status"></div>
            </div>

            <!-- Password & Security -->
            <div class="card settings-section">
              <h3>Password & Security</h3>
              <p class="muted" style="margin-bottom: 20px;">Manage your password and account security.</p>
              <div class="security-item">
                <div>
                  <h4>Change Password</h4>
                  <p class="muted">We'll send you an email with a link to reset your password.</p>
                </div>
                <button class="secondary-button" id="resetPasswordBtn">Send Reset Email</button>
              </div>
              <div class="form-message" id="passwordMessage" role="status"></div>
            </div>

            <!-- Account Management -->
            <div class="card settings-section">
              <h3>Account Management</h3>
              <p class="muted" style="margin-bottom: 20px;">Manage your account and data.</p>
              
              <div class="account-actions">
                <div class="account-action-item">
                  <div>
                    <h4>Logged in as</h4>
                    <p class="muted" id="userEmailDisplay">Loading...</p>
                  </div>
                </div>
                
                <div class="account-action-item danger-zone">
                  <div>
                    <h4>Delete Account</h4>
                    <p class="muted">Permanently delete your account and all associated data including comments.</p>
                  </div>
                  <button class="danger-button" id="deleteAccountBtn">Delete Account</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div>
          <p class="footer-title">Connor Hill's Blog</p>
          <p>¬© 2026 Connor Hill. All rights reserved.</p>
          <p class="footer-subtitle">Building awesome iOS experiences.</p>
        </div>
        <div class="footer-links">
          <div class="footer-section">
            <h4>Connect</h4>
            <a href="#" class="link-button">LinkedIn</a>
            <a href="#" class="link-button">GitHub</a>
            <a href="#" class="link-button">Twitter</a>
            <a href="mailto:hello@codejourney.dev" class="link-button">Email</a>
          </div>
          <div class="footer-section">
            <h4>Navigate</h4>
            <a href="#blogs" class="link-button">Blog</a>
            <a href="#portfolio" class="link-button">Portfolio</a>
            <a href="#about" class="link-button">About</a>
            <a href="#settings" class="link-button">Subscribe</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üîê Admin Login</h2>
          <span class="close-modal" id="closeModal">&times;</span>
        </div>
        <div class="modal-body">
          <div id="loginError" class="login-error"></div>
          <form id="modalLoginForm">
            <div class="modal-form-group">
              <label for="modalEmail">Email</label>
              <input type="email" id="modalEmail" required placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="modal-form-group">
              <label for="modalPassword">Password</label>
              <input type="password" id="modalPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
            </div>
            <button type="submit" class="primary-button" id="modalLoginButton" style="width: 100%;">
              Sign In
            </button>
          </form>
        </div>
      </div>
    </div>

    <script src="script.js"></script>
    <script type="module">
      import { auth, isAdmin } from './js/firebase-config.js';
      import { 
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut
      } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

      const loginBtn = document.getElementById('loginBtn');
      const adminPanelBtn = document.getElementById('adminPanelBtn');
      const loginModal = document.getElementById('loginModal');
      const closeModal = document.getElementById('closeModal');
      const modalLoginForm = document.getElementById('modalLoginForm');
      const modalLoginButton = document.getElementById('modalLoginButton');
      const loginError = document.getElementById('loginError');

      // Check if already logged in
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // Any logged-in user - show red Log Out button
          loginBtn.textContent = 'Log Out';
          loginBtn.classList.remove('primary-button');
          loginBtn.classList.add('logout-button');
          loginBtn.onclick = async () => {
            if (confirm('Are you sure you want to log out?')) {
              try {
                await signOut(auth);
                // Button will update automatically via onAuthStateChanged
              } catch (error) {
                console.error('Logout error:', error);
                alert('Failed to log out. Please try again.');
              }
            }
          };

          // Show admin panel button if user is admin
          if (isAdmin(user)) {
            adminPanelBtn.style.display = 'block';
          } else {
            adminPanelBtn.style.display = 'none';
          }

          // Show logged-in settings view
          updateSettingsView(user);
        } else {
          // Not logged in - show blue Log In button
          loginBtn.textContent = 'Log In';
          loginBtn.classList.remove('logout-button');
          loginBtn.classList.add('primary-button');
          loginBtn.onclick = () => loginModal.style.display = 'flex';
          adminPanelBtn.style.display = 'none';

          // Show not-logged-in settings view
          updateSettingsView(null);
        }
      });

      // Update settings view based on auth state
      function updateSettingsView(user) {
        const notLoggedInView = document.getElementById('settingsNotLoggedIn');
        const loggedInView = document.getElementById('settingsLoggedIn');

        if (user) {
          notLoggedInView.style.display = 'none';
          loggedInView.style.display = 'block';
          document.getElementById('userEmailDisplay').textContent = user.email;
          loadUserPreferences(user);
        } else {
          notLoggedInView.style.display = 'block';
          loggedInView.style.display = 'none';
        }
      }

      // Load user preferences from Firestore
      async function loadUserPreferences(user) {
        try {
          const { db } = await import('./js/firebase-config.js');
          const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const prefs = userDoc.data().emailPreferences || {};
            document.getElementById('prefNewPosts').checked = prefs.newPosts !== false;
            document.getElementById('prefProjects').checked = prefs.projects !== false;
            document.getElementById('prefCommentReplies').checked = prefs.commentReplies !== false;
            document.getElementById('prefWeeklyDigest').checked = prefs.weeklyDigest === true;
          }
        } catch (error) {
          console.error('Error loading preferences:', error);
        }
      }

      // Save preferences
      document.getElementById('savePreferencesBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) return;

        const preferencesMessage = document.getElementById('preferencesMessage');
        preferencesMessage.textContent = 'Saving...';
        preferencesMessage.style.color = 'var(--accent)';

        try {
          const { db } = await import('./js/firebase-config.js');
          const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          
          const preferences = {
            newPosts: document.getElementById('prefNewPosts').checked,
            projects: document.getElementById('prefProjects').checked,
            commentReplies: document.getElementById('prefCommentReplies').checked,
            weeklyDigest: document.getElementById('prefWeeklyDigest').checked
          };

          await updateDoc(doc(db, 'users', user.uid), {
            emailPreferences: preferences
          });

          preferencesMessage.textContent = '‚úì Preferences saved successfully';
          preferencesMessage.style.color = 'var(--accent)';
          
          setTimeout(() => {
            preferencesMessage.textContent = '';
          }, 3000);
        } catch (error) {
          console.error('Error saving preferences:', error);
          preferencesMessage.textContent = 'Error saving preferences';
          preferencesMessage.style.color = '#dc3545';
        }
      });

      // Send password reset email
      document.getElementById('resetPasswordBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) return;

        const passwordMessage = document.getElementById('passwordMessage');
        passwordMessage.textContent = 'Sending email...';
        passwordMessage.style.color = 'var(--accent)';

        try {
          const { sendPasswordResetEmail } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
          
          await sendPasswordResetEmail(auth, user.email);
          
          passwordMessage.textContent = '‚úì Password reset email sent! Check your inbox.';
          passwordMessage.style.color = 'var(--accent)';
          
          setTimeout(() => {
            passwordMessage.textContent = '';
          }, 5000);
        } catch (error) {
          console.error('Error sending password reset email:', error);
          passwordMessage.textContent = 'Error sending email. Please try again.';
          passwordMessage.style.color = '#dc3545';
        }
      });

      // Delete account
      document.getElementById('deleteAccountBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) return;

        const confirmDelete = confirm(
          'Are you sure you want to delete your account?\n\n' +
          'This will permanently delete:\n' +
          '‚Ä¢ Your account\n' +
          '‚Ä¢ All your comments\n' +
          '‚Ä¢ All your data\n\n' +
          'This action cannot be undone.'
        );

        if (!confirmDelete) return;

        const doubleConfirm = prompt(
          'To confirm deletion, please type "DELETE" in all caps:'
        );

        if (doubleConfirm !== 'DELETE') {
          alert('Account deletion cancelled.');
          return;
        }

        try {
          const { db } = await import('./js/firebase-config.js');
          const { collection, query, where, getDocs, deleteDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          const { deleteUser } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
          
          // Delete all user comments across all posts
          const postsSnapshot = await getDocs(collection(db, 'posts'));
          for (const postDoc of postsSnapshot.docs) {
            const commentsQuery = query(
              collection(db, 'posts', postDoc.id, 'comments'),
              where('userId', '==', user.uid)
            );
            const commentsSnapshot = await getDocs(commentsQuery);
            for (const commentDoc of commentsSnapshot.docs) {
              await deleteDoc(doc(db, 'posts', postDoc.id, 'comments', commentDoc.id));
            }
          }

          // Delete user document
          await deleteDoc(doc(db, 'users', user.uid));

          // Delete Firebase auth account
          await deleteUser(user);

          alert('Your account has been successfully deleted.');
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Error deleting account:', error);
          if (error.code === 'auth/requires-recent-login') {
            alert('For security reasons, please log out and log back in before deleting your account.');
          } else {
            alert('Error deleting account. Please try again or contact support.');
          }
        }
      });

      // Close modal
      closeModal.addEventListener('click', () => {
        loginModal.style.display = 'none';
        loginError.textContent = '';
        modalLoginForm.reset();
      });

      // Close modal when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === loginModal) {
          loginModal.style.display = 'none';
          loginError.textContent = '';
          modalLoginForm.reset();
        }
      });

      // Handle login
      modalLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('modalEmail').value;
        const password = document.getElementById('modalPassword').value;
        
        modalLoginButton.disabled = true;
        modalLoginButton.textContent = 'Signing in...';
        loginError.textContent = '';
        
        try {
          await signInWithEmailAndPassword(auth, email, password);
          loginModal.style.display = 'none';
          window.location.href = 'admin.html';
        } catch (error) {
          console.error('Login error:', error);
          
          let message = 'Login failed. Please check your credentials.';
          if (error.code === 'auth/user-not-found') {
            message = 'No account found with this email.';
          } else if (error.code === 'auth/wrong-password') {
            message = 'Incorrect password.';
          } else if (error.code === 'auth/invalid-email') {
            message = 'Invalid email address.';
          } else if (error.code === 'auth/too-many-requests') {
            message = 'Too many failed attempts. Try again later.';
          } else if (error.code === 'auth/invalid-credential') {
            message = 'Invalid credentials. Please check your email and password.';
          }
          
          loginError.textContent = message;
          modalLoginButton.disabled = false;
          modalLoginButton.textContent = 'Sign In';
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && loginModal.style.display === 'flex') {
          loginModal.style.display = 'none';
          loginError.textContent = '';
          modalLoginForm.reset();
        }
      });
    </script>
  </body>
</html>
