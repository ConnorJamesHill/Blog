<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Connor Hill's Blog</title>
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <header class="hero">
      <nav class="nav">
        <div class="brand">
          <span class="brand-mark">Ô£ø</span>
          <div class="brand-text">
            <p class="brand-title">Connor Hill</p>
            <p class="brand-subtitle">iOS Developer ¬∑ Blog & Portfolio</p>
          </div>
        </div>
        <div class="nav-actions">
          <button class="ghost-button" type="button" onclick="window.location.href='#settings'">Subscribe</button>
          <button class="secondary-button" type="button" id="adminPanelBtn" style="display: none;" onclick="window.location.href='admin.html'">Admin Panel</button>
          <button class="primary-button" type="button" id="loginBtn">Log In</button>
        </div>
      </nav>
      <div class="hero-content">
        <div class="hero-text">
          <p class="eyebrow">Swift ¬∑ UIKit ¬∑ SwiftUI ¬∑ Xcode</p>
          <h1>Sharing my coding journey through polished iOS experiences.</h1>
          <p class="hero-description">
            A modern space to document lessons learned, showcase shipped apps,
            and connect with developers who care about their craft.
          </p>
          <div class="hero-cta">
            <button class="primary-button" type="button" id="joinBlogBtn" onclick="window.location.href='#settings'">Join the Blog</button>
            <button class="secondary-button" type="button" onclick="window.location.href='#portfolio'">View Portfolio</button>
          </div>
        </div>
        <div class="hero-card">
          <h2>Newsletter Highlights</h2>
          <p>
            New blog posts and project launches are delivered straight to your
            inbox. Confirm your email within 24 hours to activate alerts.
          </p>
          <div class="email-tags">
            <span>New Posts</span>
            <span>Portfolio Drops</span>
            <span>iOS Tips</span>
          </div>
        </div>
      </div>
    </header>

    <main class="main">
      <section class="tabs">
        <button class="tab active" data-tab="blogs">Blogs</button>
        <button class="tab" data-tab="portfolio">Portfolio</button>
        <button class="tab" data-tab="socials">Socials</button>
        <button class="tab" data-tab="about">About Me</button>
        <button class="tab" data-tab="settings">Settings</button>
      </section>

      <section class="tab-panel active" id="blogs">
        <div class="panel-header">
          <div>
            <h2>All Blog Posts</h2>
            <p class="muted">
              Deep dives, quick tips, and lessons from building iOS products.
            </p>
          </div>
        </div>

        <div id="blogPostsList">
          <!-- Blog posts with comments will be dynamically inserted here -->
        </div>
      </section>

      <section class="tab-panel" id="portfolio">
        <div class="panel-header">
          <div>
            <h2>Portfolio</h2>
            <p class="muted">
              A curated list of iOS apps, websites, and projects I've built.
            </p>
          </div>
        </div>

        <!-- Apps Section -->
        <div class="portfolio-section">
          <h3 class="portfolio-section-title">Apps</h3>
          <div class="content-grid">
            <article class="card project-card">
              <a href="https://apps.apple.com/us/app/perk-punch/id6746662386" target="_blank" class="project-icon-link">
                <img
                  class="project-icon"
                  src="images/perk-punch-icon.png"
                  alt="Perk Punch app icon"
                />
              </a>
              <h3>
                <a href="https://apps.apple.com/us/app/perk-punch/id6746662386" target="_blank">Perk Punch</a>
              </h3>
              <p>Punch Your Way to Perks.</p>
              <div class="project-tags">
                <span>Loyalty</span>
                <span>Rewards</span>
                <span>iOS</span>
              </div>
            </article>
            <article class="card project-card">
              <a href="https://apps.apple.com/us/app/bookworm/id6738531588" target="_blank" class="project-icon-link">
                <img
                  class="project-icon"
                  src="images/bookworm-icon.png"
                  alt="BookWorm! app icon"
                />
              </a>
              <h3>
                <a href="https://apps.apple.com/us/app/bookworm/id6738531588" target="_blank">BookWorm!</a>
              </h3>
              <p>Library, organize, search.</p>
              <div class="project-tags">
                <span>Library</span>
                <span>Catalog</span>
                <span>Search</span>
              </div>
            </article>
            <article class="card project-card">
              <a href="https://apps.apple.com/us/app/auto-do-it/id6670796120" target="_blank" class="project-icon-link">
                <img
                  class="project-icon"
                  src="images/auto-do-it-icon.png"
                  alt="Auto Do It app icon"
                />
              </a>
              <h3>
                <a href="https://apps.apple.com/us/app/auto-do-it/id6670796120" target="_blank">Auto Do It</a>
              </h3>
              <p>ToDo List Plan, Organize, AI.</p>
              <div class="project-tags">
                <span>To-Do</span>
                <span>Planning</span>
                <span>AI</span>
              </div>
            </article>
          </div>
        </div>

        <!-- Websites Section -->
        <div class="portfolio-section">
          <h3 class="portfolio-section-title">Websites</h3>
          <div class="content-grid">
            <article class="card project-card">
              <div class="project-icon-placeholder website-icon">
                <span style="font-size: 32px; font-weight: 700; color: white;">CB</span>
              </div>
              <h3>
                <a href="#" target="_blank">Connor Hill's Blog</a>
              </h3>
              <p>Personal blog and portfolio built from scratch with vanilla HTML, CSS, and JavaScript. Firebase backend for comments and authentication.</p>
              <div class="project-tags">
                <span>Web</span>
                <span>Firebase</span>
                <span>Blog</span>
              </div>
            </article>

            <article class="card project-card">
              <div class="project-icon-placeholder website-icon">
                <span style="font-size: 32px; font-weight: 700; color: white;">SS</span>
              </div>
              <h3>
                <a href="https://seefsavage.netlify.app/" target="_blank">Seef Savage</a>
              </h3>
              <p>Professional website for a YouTube content creator featuring gaming content and community engagement. Built from scratch with modern web technologies.</p>
              <div class="project-tags">
                <span>Web</span>
                <span>YouTube</span>
                <span>Gaming</span>
              </div>
            </article>

            <article class="card project-card">
              <div class="project-icon-placeholder website-icon">
                <span style="font-size: 32px; font-weight: 700; color: white;">CH</span>
              </div>
              <h3>
                <a href="https://connorjhill.netlify.app/" target="_blank">Connor Hill Portfolio</a>
              </h3>
              <p>Personal portfolio website showcasing iOS development projects and skills. Fully responsive design built from scratch with vanilla web technologies.</p>
              <div class="project-tags">
                <span>Web</span>
                <span>Portfolio</span>
                <span>Responsive</span>
              </div>
            </article>
          </div>
        </div>

        <!-- Other Section -->
        <div class="portfolio-section">
          <h3 class="portfolio-section-title">Other Projects</h3>
          <div class="card" style="text-align: center; padding: 40px;">
            <p style="color: var(--text-secondary); margin-bottom: 24px; font-size: 16px;">
              No projects here yet, but feel free to check out more of my projects on GitHub!
            </p>
            <a href="https://github.com/ConnorJamesHill" target="_blank" class="primary-button" style="text-decoration: none; display: inline-flex; align-items: center; gap: 8px;">
              View GitHub Profile
              <span style="font-size: 18px;">‚Üí</span>
            </a>
          </div>
        </div>
      </section>

      <section class="tab-panel" id="socials">
        <div class="panel-header">
          <div>
            <h2>Connect With Me</h2>
            <p class="muted">
              Follow my journey across different platforms and stay connected.
            </p>
          </div>
        </div>
        
        <div class="socials-grid">
          <a href="https://x.com/ConnorJayHill" target="_blank" class="social-card twitter-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>Twitter</h3>
              <p>Follow me for iOS dev tips and updates</p>
              <span class="social-handle">@ConnorJayHill</span>
            </div>
          </a>

          <a href="https://bsky.app/profile/connorjameshill.bsky.social" target="_blank" class="social-card bluesky-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M12 2C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2zm0 18c-4.411 0-8-3.589-8-8s3.589-8 8-8 8 3.589 8 8-3.589 8-8 8zm-1-13h2v6h-2zm0 8h2v2h-2z"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>Bluesky</h3>
              <p>Connect on the decentralized social network</p>
              <span class="social-handle">@connorjameshill.bsky.social</span>
            </div>
          </a>

          <a href="https://linkedin.com/in/connor-j-hill" target="_blank" class="social-card linkedin-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>LinkedIn</h3>
              <p>Professional network and career updates</p>
              <span class="social-handle">Connor Hill</span>
            </div>
          </a>

          <a href="https://www.instagram.com/connorjayhill/" target="_blank" class="social-card instagram-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M12 2.163c3.204 0 3.584.012 4.85.07 3.252.148 4.771 1.691 4.919 4.919.058 1.265.069 1.645.069 4.849 0 3.205-.012 3.584-.069 4.849-.149 3.225-1.664 4.771-4.919 4.919-1.266.058-1.644.07-4.85.07-3.204 0-3.584-.012-4.849-.07-3.26-.149-4.771-1.699-4.919-4.92-.058-1.265-.07-1.644-.07-4.849 0-3.204.013-3.583.07-4.849.149-3.227 1.664-4.771 4.919-4.919 1.266-.057 1.645-.069 4.849-.069zm0-2.163c-3.259 0-3.667.014-4.947.072-4.358.2-6.78 2.618-6.98 6.98-.059 1.281-.073 1.689-.073 4.948 0 3.259.014 3.668.072 4.948.2 4.358 2.618 6.78 6.98 6.98 1.281.058 1.689.072 4.948.072 3.259 0 3.668-.014 4.948-.072 4.354-.2 6.782-2.618 6.979-6.98.059-1.28.073-1.689.073-4.948 0-3.259-.014-3.667-.072-4.947-.196-4.354-2.617-6.78-6.979-6.98-1.281-.059-1.69-.073-4.949-.073zm0 5.838c-3.403 0-6.162 2.759-6.162 6.162s2.759 6.163 6.162 6.163 6.162-2.759 6.162-6.163c0-3.403-2.759-6.162-6.162-6.162zm0 10.162c-2.209 0-4-1.79-4-4 0-2.209 1.791-4 4-4s4 1.791 4 4c0 2.21-1.791 4-4 4zm6.406-11.845c-.796 0-1.441.645-1.441 1.44s.645 1.44 1.441 1.44c.795 0 1.439-.645 1.439-1.44s-.644-1.44-1.439-1.44z"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>Instagram</h3>
              <p>Behind the scenes and personal updates</p>
              <span class="social-handle">@connorjayhill</span>
            </div>
          </a>

          <a href="https://www.tiktok.com/@connorjameshill" target="_blank" class="social-card tiktok-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M12.525.02c1.31-.02 2.61-.01 3.91-.02.08 1.53.63 3.09 1.75 4.17 1.12 1.11 2.7 1.62 4.24 1.79v4.03c-1.44-.05-2.89-.35-4.2-.97-.57-.26-1.1-.59-1.62-.93-.01 2.92.01 5.84-.02 8.75-.08 1.4-.54 2.79-1.35 3.94-1.31 1.92-3.58 3.17-5.91 3.21-1.43.08-2.86-.31-4.08-1.03-2.02-1.19-3.44-3.37-3.65-5.71-.02-.5-.03-1-.01-1.49.18-1.9 1.12-3.72 2.58-4.96 1.66-1.44 3.98-2.13 6.15-1.72.02 1.48-.04 2.96-.04 4.44-.99-.32-2.15-.23-3.02.37-.63.41-1.11 1.04-1.36 1.75-.21.51-.15 1.07-.14 1.61.24 1.64 1.82 3.02 3.5 2.87 1.12-.01 2.19-.66 2.77-1.61.19-.33.4-.67.41-1.06.1-1.79.06-3.57.07-5.36.01-4.03-.01-8.05.02-12.07z"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>TikTok</h3>
              <p>Quick tips and coding content</p>
              <span class="social-handle">@connorjameshill</span>
            </div>
          </a>

          <a href="https://github.com/ConnorJamesHill" target="_blank" class="social-card github-card">
            <div class="social-icon">
              <svg viewBox="0 0 24 24" fill="currentColor" width="32" height="32">
                <path d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"/>
              </svg>
            </div>
            <div class="social-content">
              <h3>GitHub</h3>
              <p>Open source projects and contributions</p>
              <span class="social-handle">@ConnorJamesHill</span>
            </div>
          </a>
        </div>
      </section>

      <section class="tab-panel" id="about">
        <div class="panel-header">
          <div>
            <h2>About the Author</h2>
            <p class="muted">My journey into iOS development and what drives me.</p>
          </div>
        </div>
        <div class="card about-card">
          <h3 style="margin-bottom: 16px; color: var(--text-primary);">Connor Hill</h3>
          <p>
            I began my iOS development journey 2 years ago, diving deep into Swift, SwiftUI, and the Apple ecosystem. 
            What started as curiosity about building mobile apps quickly evolved into a passion for crafting polished, 
            user focused experiences.
          </p>
          <p>
            Since then, I've successfully launched 3 apps on the App Store, each teaching me valuable lessons about 
            design, performance optimization, and the importance of user feedback. From conceptualization to 
            App Store submission, I've experienced the full development lifecycle and loved every minute of it.
          </p>
          <p>
            Through this blog, I document my learning process, share insights on iOS development best practices, 
            and explore the evolving landscape of Apple platforms. Whether it's deep diving into SwiftUI patterns, 
            profiling app performance, or discussing architecture decisions, I aim to create content that helps myself and
            fellow developers grow.
          </p>
          <p>
            I plan to continue expanding my app portfolio, experimenting with new Apple technologies, and learning 
            as much as I can about building awesome iOS experiences just like that first time I uploaded to the App Store! My goal is to master Apple's 
            APIs and frameworks while sharing what I learn along the way. Enjoy!
          </p>
          <div class="about-stats">
            <div>
              <h4 style="color: var(--accent);">2+</h4>
              <span>Years in iOS</span>
            </div>
            <div>
              <h4 style="color: var(--accent);">3</h4>
              <span>Apps in App Store</span>
            </div>
            <div>
              <h4 style="color: var(--accent);">‚àû</h4>
              <span>Always Learning</span>
            </div>
          </div>
          <div style="margin-top: 32px; padding-top: 32px; border-top: 1px solid var(--border);">
            <p style="margin-bottom: 8px; font-weight: 600; color: var(--text-primary);">
              Let's Connect
            </p>
            <p style="color: var(--text-secondary); margin-bottom: 12px;">
              Have questions, collaboration ideas, or just want to chat about iOS development?
            </p>
            <p>
              <strong>Email:</strong> 
              <a href="mailto:hilljamesconnor@gmail.com" style="color: var(--accent); text-decoration: none;">
                hilljamesconnor@gmail.com
              </a>
            </p>
          </div>
        </div>
      </section>

      <section class="tab-panel" id="settings">
        <!-- Not Logged In View -->
        <div id="settingsNotLoggedIn">
          <div class="panel-header">
            <div>
              <h2>Newsletter</h2>
              <p class="muted">
                Subscribe to get notified when I publish new posts or launch new projects.
              </p>
            </div>
          </div>
          <div class="settings-grid">
            <form class="card join-card" id="joinForm">
              <h3>Subscribe</h3>
              <p>
                Create an account to follow along with new iOS tutorials and app releases.
              </p>
              <input type="text" name="fullName" id="joinFullName" placeholder="Full name" required />
              <input type="email" name="email" id="joinEmail" placeholder="Email address" required />
              <input type="password" name="password" id="joinPassword" placeholder="Create password (min 6 characters)" required minlength="6" />
              <button class="primary-button" type="submit">Create Account</button>
              <div class="form-message" id="joinMessage" role="status"></div>
              <p class="form-note">
                <small>No spam. Unsubscribe anytime.</small>
              </p>
            </form>

            <div class="card preferences-card">
              <h3>What to Expect</h3>
              <div class="benefits-list">
                <div class="benefit-item">
                  <div>
                    <h4>New Post Notifications</h4>
                    <p class="muted">Get an email when I publish a new tutorial or article.</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <div>
                    <h4>Project Updates</h4>
                    <p class="muted">Updates when I launch new apps or add to my portfolio.</p>
                  </div>
                </div>
                <div class="benefit-item">
                  <div>
                    <h4>Comment Notifications</h4>
                    <p class="muted">Optional replies to your comments on posts.</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Logged In View -->
        <div id="settingsLoggedIn" style="display: none;">
          <div class="panel-header">
            <div>
              <h2>Account Settings</h2>
              <p class="muted">
                Manage your preferences, password, and account.
              </p>
            </div>
          </div>
          
          <div class="settings-grid-full">
            <!-- Email Preferences -->
            <div class="card settings-section">
              <h3>Email Preferences</h3>
              <p class="muted" style="margin-bottom: 20px;">Choose what you want to be notified about via email.</p>
              <div class="preferences-list">
                <label class="preference-item">
                  <input type="checkbox" id="prefNewPosts" checked />
                  <div>
                    <h4>New Blog Posts</h4>
                    <p class="muted">Get notified when I publish a new article or tutorial.</p>
                  </div>
                </label>
                <label class="preference-item">
                  <input type="checkbox" id="prefProjects" checked />
                  <div>
                    <h4>Project Updates</h4>
                    <p class="muted">Updates when I launch new apps or portfolio additions.</p>
                  </div>
                </label>
                <label class="preference-item">
                  <input type="checkbox" id="prefCommentReplies" checked />
                  <div>
                    <h4>Comment Replies</h4>
                    <p class="muted">Get notified when someone replies to your comments.</p>
                  </div>
                </label>
              </div>
              <button class="primary-button" id="savePreferencesBtn" style="margin-top: 20px;">Save Preferences</button>
              <div class="form-message" id="preferencesMessage" role="status"></div>
            </div>

            <!-- Password & Security -->
            <div class="card settings-section">
              <h3>Password & Security</h3>
              <p class="muted" style="margin-bottom: 20px;">Manage your password and account security.</p>
              <div class="security-item">
                <div>
                  <h4>Change Password</h4>
                  <p class="muted">We'll send you an email with a link to reset your password.</p>
                </div>
                <button class="secondary-button" id="resetPasswordBtn">Send Reset Email</button>
              </div>
              <div class="form-message" id="passwordMessage" role="status"></div>
            </div>

            <!-- Account Management -->
            <div class="card settings-section">
              <h3>Account Management</h3>
              <p class="muted" style="margin-bottom: 20px;">Manage your account and data.</p>
              
              <div class="account-actions">
                <div class="account-action-item">
                  <div>
                    <h4>Logged in as</h4>
                    <p class="muted" id="userEmailDisplay">Loading...</p>
                  </div>
                </div>
                
                <div class="account-action-item danger-zone">
                  <div>
                    <h4>Delete Account</h4>
                    <p class="muted">Permanently delete your account and all associated data including comments.</p>
                  </div>
                  <button class="danger-button" id="deleteAccountBtn">Delete Account</button>
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>
    </main>

    <footer class="footer">
      <div class="footer-content">
        <div>
          <p class="footer-title">Connor Hill's Blog</p>
          <p>¬© 2026 Connor Hill. All rights reserved.</p>
          <p class="footer-subtitle">Building awesome iOS experiences.</p>
        </div>
        <div class="footer-links">
          <div class="footer-section">
            <h4>Connect</h4>
            <a href="#" class="link-button">LinkedIn</a>
            <a href="#" class="link-button">GitHub</a>
            <a href="#" class="link-button">Twitter</a>
            <a href="mailto:hello@codejourney.dev" class="link-button">Email</a>
          </div>
          <div class="footer-section">
            <h4>Navigate</h4>
            <a href="#blogs" class="link-button">Blog</a>
            <a href="#portfolio" class="link-button">Portfolio</a>
            <a href="#about" class="link-button">About</a>
            <a href="#settings" class="link-button">Subscribe</a>
          </div>
          <div class="footer-section">
            <h4>Other</h4>
            <a href="faq.html" class="link-button">FAQ</a>
            <a href="#" class="link-button" id="forgotPasswordLink">Forgot Password?</a>
            <a href="terms.html" class="link-button">Terms of Service</a>
            <a href="privacy.html" class="link-button">Privacy Policy</a>
          </div>
        </div>
      </div>
    </footer>

    <!-- Login Modal -->
    <div id="loginModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üîê Log In</h2>
          <span class="close-modal" id="closeModal">&times;</span>
        </div>
        <div class="modal-body">
          <div id="loginError" class="login-error"></div>
          <form id="modalLoginForm">
            <div class="modal-form-group">
              <label for="modalEmail">Email</label>
              <input type="email" id="modalEmail" required placeholder="your@email.com" autocomplete="email">
            </div>
            <div class="modal-form-group">
              <label for="modalPassword">Password</label>
              <input type="password" id="modalPassword" required placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password">
            </div>
            <button type="submit" class="primary-button" id="modalLoginButton" style="width: 100%;">
              Sign In
            </button>
          </form>
        </div>
      </div>
    </div>

    <!-- Forgot Password Modal -->
    <div id="forgotPasswordModal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h2>üîë Reset Password</h2>
          <span class="close-modal" id="closeForgotPasswordModal">&times;</span>
        </div>
        <div class="modal-body">
          <p style="color: var(--text-secondary); margin-bottom: 20px;">
            Enter your email address and we'll send you a link to reset your password.
          </p>
          <div id="forgotPasswordMessage" class="form-message"></div>
          <form id="forgotPasswordForm">
            <div class="modal-form-group">
              <label for="forgotPasswordEmail">Email Address</label>
              <input type="email" id="forgotPasswordEmail" required placeholder="your@email.com" autocomplete="email">
            </div>
            <button type="submit" class="primary-button" style="width: 100%;">
              Send Reset Link
            </button>
          </form>
        </div>
      </div>
    </div>

    <script type="module" src="script.js"></script>
    <script type="module">
      import { auth, isAdmin } from './js/firebase-config.js';
      import { 
        signInWithEmailAndPassword,
        onAuthStateChanged,
        signOut
      } from 'https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js';

      const loginBtn = document.getElementById('loginBtn');
      const joinBlogBtn = document.getElementById('joinBlogBtn');
      const adminPanelBtn = document.getElementById('adminPanelBtn');
      const loginModal = document.getElementById('loginModal');
      const closeModal = document.getElementById('closeModal');
      const modalLoginForm = document.getElementById('modalLoginForm');
      const modalLoginButton = document.getElementById('modalLoginButton');
      const loginError = document.getElementById('loginError');

      // Check if already logged in
      onAuthStateChanged(auth, (user) => {
        if (user) {
          // Any logged-in user - show red Log Out button
          loginBtn.textContent = 'Log Out';
          loginBtn.classList.remove('primary-button');
          loginBtn.classList.add('logout-button');
          loginBtn.onclick = async () => {
            if (confirm('Are you sure you want to log out?')) {
              try {
                await signOut(auth);
                // Button will update automatically via onAuthStateChanged
              } catch (error) {
                console.error('Logout error:', error);
                alert('Failed to log out. Please try again.');
              }
            }
          };

          // Update "Join the Blog" button to "Welcome!"
          joinBlogBtn.textContent = 'Welcome!';
          joinBlogBtn.onclick = null;
          joinBlogBtn.style.cursor = 'default';

          // Show admin panel button if user is admin
          if (isAdmin(user)) {
            adminPanelBtn.style.display = 'block';
          } else {
            adminPanelBtn.style.display = 'none';
          }

          // Show logged-in settings view
          updateSettingsView(user);
        } else {
          // Not logged in - show blue Log In button
          loginBtn.textContent = 'Log In';
          loginBtn.classList.remove('logout-button');
          loginBtn.classList.add('primary-button');
          loginBtn.onclick = () => loginModal.style.display = 'flex';
          adminPanelBtn.style.display = 'none';

          // Reset "Join the Blog" button
          joinBlogBtn.textContent = 'Join the Blog';
          joinBlogBtn.onclick = () => window.location.href = '#settings';
          joinBlogBtn.style.cursor = 'pointer';

          // Show not-logged-in settings view
          updateSettingsView(null);
        }
      });

      // Update settings view based on auth state
      function updateSettingsView(user) {
        const notLoggedInView = document.getElementById('settingsNotLoggedIn');
        const loggedInView = document.getElementById('settingsLoggedIn');

        if (user) {
          notLoggedInView.style.display = 'none';
          loggedInView.style.display = 'block';
          document.getElementById('userEmailDisplay').textContent = user.email;
          loadUserPreferences(user);
        } else {
          notLoggedInView.style.display = 'block';
          loggedInView.style.display = 'none';
        }
      }

      // Load user preferences from Firestore
      async function loadUserPreferences(user) {
        try {
          const { db } = await import('./js/firebase-config.js');
          const { doc, getDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          
          const userDoc = await getDoc(doc(db, 'users', user.uid));
          if (userDoc.exists()) {
            const prefs = userDoc.data().emailPreferences || {};
            document.getElementById('prefNewPosts').checked = prefs.newPosts !== false;
            document.getElementById('prefProjects').checked = prefs.projects !== false;
            document.getElementById('prefCommentReplies').checked = prefs.commentReplies !== false;
          }
        } catch (error) {
          console.error('Error loading preferences:', error);
        }
      }

      // Save preferences
      document.getElementById('savePreferencesBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) {
          console.error('No user logged in');
          return;
        }

        const preferencesMessage = document.getElementById('preferencesMessage');
        preferencesMessage.textContent = 'Saving...';
        preferencesMessage.style.color = 'var(--accent)';

        try {
          const { db } = await import('./js/firebase-config.js');
          const { doc, updateDoc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          
          const preferences = {
            newPosts: document.getElementById('prefNewPosts').checked,
            projects: document.getElementById('prefProjects').checked,
            commentReplies: document.getElementById('prefCommentReplies').checked
          };

          console.log('Saving preferences for user:', user.uid, preferences);
          await updateDoc(doc(db, 'users', user.uid), {
            emailPreferences: preferences
          });

          console.log('Preferences saved successfully');
          preferencesMessage.textContent = '‚úì Preferences saved successfully';
          preferencesMessage.style.color = 'var(--accent)';
          
          setTimeout(() => {
            preferencesMessage.textContent = '';
          }, 3000);
        } catch (error) {
          console.error('Error saving preferences:', error);
          preferencesMessage.textContent = `Error: ${error.message}`;
          preferencesMessage.style.color = '#dc3545';
        }
      });

      // Send password reset email
      document.getElementById('resetPasswordBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) {
          console.error('No user logged in');
          return;
        }

        const passwordMessage = document.getElementById('passwordMessage');
        passwordMessage.textContent = 'Sending email...';
        passwordMessage.style.color = 'var(--accent)';

        try {
          const { sendPasswordResetEmail } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
          
          console.log('Sending password reset email to:', user.email);
          await sendPasswordResetEmail(auth, user.email);
          
          console.log('Password reset email sent successfully');
          passwordMessage.textContent = '‚úì Password reset email sent! Check your inbox.';
          passwordMessage.style.color = 'var(--accent)';
          
          setTimeout(() => {
            passwordMessage.textContent = '';
          }, 5000);
        } catch (error) {
          console.error('Error sending password reset email:', error);
          passwordMessage.textContent = `Error: ${error.message}`;
          passwordMessage.style.color = '#dc3545';
        }
      });

      // Delete account
      document.getElementById('deleteAccountBtn').addEventListener('click', async () => {
        const user = auth.currentUser;
        if (!user) {
          console.error('No user logged in');
          return;
        }

        const confirmDelete = confirm(
          'Are you sure you want to delete your account?\n\n' +
          'This will permanently delete:\n' +
          '‚Ä¢ Your account\n' +
          '‚Ä¢ All your comments\n' +
          '‚Ä¢ All your data\n\n' +
          'This action cannot be undone.'
        );

        if (!confirmDelete) return;

        const doubleConfirm = prompt(
          'To confirm deletion, please type "DELETE" in all caps:'
        );

        if (doubleConfirm !== 'DELETE') {
          alert('Account deletion cancelled.');
          return;
        }

        try {
          console.log('Starting account deletion for user:', user.uid);
          const { db } = await import('./js/firebase-config.js');
          const { collection, query, where, getDocs, deleteDoc, doc } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js');
          const { deleteUser } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
          
          // Delete all user comments across all posts
          console.log('Deleting user comments...');
          const postsSnapshot = await getDocs(collection(db, 'posts'));
          let deletedComments = 0;
          for (const postDoc of postsSnapshot.docs) {
            const commentsQuery = query(
              collection(db, 'posts', postDoc.id, 'comments'),
              where('userId', '==', user.uid)
            );
            const commentsSnapshot = await getDocs(commentsQuery);
            for (const commentDoc of commentsSnapshot.docs) {
              await deleteDoc(doc(db, 'posts', postDoc.id, 'comments', commentDoc.id));
              deletedComments++;
            }
          }
          console.log(`Deleted ${deletedComments} comments`);

          // Delete user document
          console.log('Deleting user document...');
          await deleteDoc(doc(db, 'users', user.uid));

          // Delete Firebase auth account
          console.log('Deleting Firebase auth account...');
          await deleteUser(user);

          console.log('Account deletion complete');
          alert('Your account has been successfully deleted.');
          window.location.href = 'index.html';
        } catch (error) {
          console.error('Error deleting account:', error);
          if (error.code === 'auth/requires-recent-login') {
            alert('For security reasons, please log out and log back in before deleting your account.');
          } else {
            alert(`Error deleting account: ${error.message}\n\nPlease check the console for details or contact support.`);
          }
        }
      });

      // Close modal
      closeModal.addEventListener('click', () => {
        loginModal.style.display = 'none';
        loginError.textContent = '';
        modalLoginForm.reset();
      });

      // Close modal when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === loginModal) {
          loginModal.style.display = 'none';
          loginError.textContent = '';
          modalLoginForm.reset();
        }
      });

      // Handle login
      modalLoginForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('modalEmail').value;
        const password = document.getElementById('modalPassword').value;
        
        modalLoginButton.disabled = true;
        modalLoginButton.textContent = 'Signing in...';
        loginError.textContent = '';
        
        try {
          const userCredential = await signInWithEmailAndPassword(auth, email, password);
          loginModal.style.display = 'none';
          modalLoginForm.reset();
          
          // Only redirect to admin page if user is admin
          if (isAdmin(userCredential.user)) {
            window.location.href = 'admin.html';
          }
          // Regular users just stay on the page - modal closes and UI updates via onAuthStateChanged
        } catch (error) {
          console.error('Login error:', error);
          
          let message = 'Login failed. Please check your credentials.';
          if (error.code === 'auth/user-not-found') {
            message = 'No account found with this email.';
          } else if (error.code === 'auth/wrong-password') {
            message = 'Incorrect password.';
          } else if (error.code === 'auth/invalid-email') {
            message = 'Invalid email address.';
          } else if (error.code === 'auth/too-many-requests') {
            message = 'Too many failed attempts. Try again later.';
          } else if (error.code === 'auth/invalid-credential') {
            message = 'Invalid credentials. Please check your email and password.';
          }
          
          loginError.textContent = message;
          modalLoginButton.disabled = false;
          modalLoginButton.textContent = 'Sign In';
        }
      });

      // Close modal with Escape key
      document.addEventListener('keydown', (e) => {
        if (e.key === 'Escape' && loginModal.style.display === 'flex') {
          loginModal.style.display = 'none';
          loginError.textContent = '';
          modalLoginForm.reset();
        }
        if (e.key === 'Escape' && forgotPasswordModal.style.display === 'flex') {
          forgotPasswordModal.style.display = 'none';
          forgotPasswordMessage.textContent = '';
          forgotPasswordForm.reset();
        }
      });

      // Forgot Password Modal
      const forgotPasswordModal = document.getElementById('forgotPasswordModal');
      const forgotPasswordLink = document.getElementById('forgotPasswordLink');
      const closeForgotPasswordModal = document.getElementById('closeForgotPasswordModal');
      const forgotPasswordForm = document.getElementById('forgotPasswordForm');
      const forgotPasswordMessage = document.getElementById('forgotPasswordMessage');

      // Open forgot password modal
      forgotPasswordLink.addEventListener('click', (e) => {
        e.preventDefault();
        forgotPasswordModal.style.display = 'flex';
      });

      // Close forgot password modal
      closeForgotPasswordModal.addEventListener('click', () => {
        forgotPasswordModal.style.display = 'none';
        forgotPasswordMessage.textContent = '';
        forgotPasswordForm.reset();
      });

      // Close modal when clicking outside
      window.addEventListener('click', (e) => {
        if (e.target === forgotPasswordModal) {
          forgotPasswordModal.style.display = 'none';
          forgotPasswordMessage.textContent = '';
          forgotPasswordForm.reset();
        }
      });

      // Handle forgot password form submission
      forgotPasswordForm.addEventListener('submit', async (e) => {
        e.preventDefault();
        
        const email = document.getElementById('forgotPasswordEmail').value;
        
        forgotPasswordMessage.textContent = 'Sending email...';
        forgotPasswordMessage.style.color = 'var(--accent)';

        try {
          const { sendPasswordResetEmail } = await import('https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js');
          
          await sendPasswordResetEmail(auth, email);
          
          forgotPasswordMessage.textContent = '‚úì Password reset email sent! Check your inbox.';
          forgotPasswordMessage.style.color = 'var(--accent)';
          
          setTimeout(() => {
            forgotPasswordModal.style.display = 'none';
            forgotPasswordMessage.textContent = '';
            forgotPasswordForm.reset();
          }, 3000);
        } catch (error) {
          console.error('Error sending password reset email:', error);
          
          let message = 'Error sending reset email. Please try again.';
          if (error.code === 'auth/user-not-found') {
            message = 'No account found with this email address.';
          } else if (error.code === 'auth/invalid-email') {
            message = 'Invalid email address.';
          }
          
          forgotPasswordMessage.textContent = message;
          forgotPasswordMessage.style.color = '#dc3545';
        }
      });
    </script>
  </body>
</html>
